#!/usr/bin/env ruby

require "keeptesting"
require "optparse"
require 'fssm'

def parse_options
  options = {}

  OptionParser.new do |o|
    o.banner = "Usage: keeptesting [options] -f 'FAILURE-MATCHING-REGEX' -t 'TEST-COMMAND'\n\n"
    
    o.on("-f F", "--failure-matching-regex", "A regex that matches failing tests") { |f| options[:failure_regex] = f } 
    o.on("-t T", "--test-command", "Command to start your test(s)") { |t| options[:test_command] = t }

    o.on("-c", "--command-line-mode", "Get test feedback in terminal") { options[:cli_mode] = true}
    
    o.on("-h", "--help", "Help page") { puts o; exit }
    o.on("-v", "--version", "Print version number") { |b| puts Keeptesting::VERSION; exit }

    o.parse!
  end

  return options
end


options = parse_options

if !options[:failure_regex] || !options[:test_command]
  puts "ERROR: missing args!" # TODO do this in optionsparse step above
end

if options[:cli_mode]
  Keeptesting::CLI::start_test_loop(options)
else
  Keeptesting::BrowserConsole.new(options)
end


